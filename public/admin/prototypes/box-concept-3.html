<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Concept 3: Smart Command Palette</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: { extend: { colors: { harvest: { 500: '#10B981', 600: '#059669', 900: '#064E3B' } } } }
        }
    </script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
</head>

<body class="bg-gray-100 min-h-screen text-gray-800 font-sans flex items-start justify-center pt-20">

    <!-- Modal Container (Simulated) -->
    <div
        class="bg-white rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden ring-1 ring-black/5 relative min-h-[500px] flex flex-col">

        <!-- HEADER / INPUT AREA -->
        <div class="p-4 border-b border-gray-100 bg-white relative z-20">
            <div class="flex items-center justify-between mb-4">
                <h1 class="text-xs font-bold uppercase tracking-widest text-gray-400">P3: Command Mode</h1>
                <a href="box-concept-1.html" class="text-xs text-blue-500 hover:underline">Restart Demo Loop</a>
            </div>

            <div class="relative">
                <i class="ri-search-line absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 text-lg"></i>
                <input type="text" id="command-input"
                    class="w-full pl-12 pr-4 py-4 bg-gray-50 border-none rounded-lg text-lg focus:ring-2 focus:ring-blue-500 outline-none placeholder-gray-400 font-medium"
                    placeholder="Type to search products..." autocomplete="off">
                <div class="absolute right-4 top-1/2 -translate-y-1/2 flex gap-2">
                    <kbd
                        class="hidden sm:inline-block px-2 py-1 bg-white border border-gray-200 rounded-md text-xs text-gray-500 font-mono shadow-sm">ESC</kbd>
                    <kbd
                        class="hidden sm:inline-block px-2 py-1 bg-white border border-gray-200 rounded-md text-xs text-gray-500 font-mono shadow-sm">â†µ</kbd>
                </div>
            </div>

            <!-- Suggestion Popover (Hidden by default) -->
            <div id="suggestions"
                class="absolute top-full left-0 w-full bg-white shadow-xl rounded-b-xl border border-gray-100 overflow-hidden hidden max-h-80 overflow-y-auto">
                <!-- suggestions injected JS -->
            </div>
        </div>

        <!-- CURRENT BOX LIST -->
        <div class="flex-1 bg-gray-50/50 p-0 overflow-y-auto">
            <table class="w-full text-sm text-left">
                <thead class="text-xs text-gray-400 uppercase bg-gray-50 border-b border-gray-200">
                    <tr>
                        <th class="px-6 py-3 font-semibold">Product</th>
                        <th class="px-6 py-3 font-semibold w-24 text-center">Qty</th>
                        <th class="px-6 py-3 font-semibold w-24 text-right">Price</th>
                        <th class="px-6 py-3 w-10"></th>
                    </tr>
                </thead>
                <tbody id="box-items" class="divide-y divide-gray-100 bg-white">
                    <!-- Items -->
                </tbody>
            </table>

            <div id="empty-msg" class="text-center py-12 text-gray-400">
                <p>Start typing above to build your box.</p>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="p-4 bg-gray-50 border-t border-gray-200 flex justify-between items-center text-sm">
            <div class="font-mono text-gray-500" id="status-bar">Ready</div>
            <div class="flex gap-4 items-center">
                <div class="text-right">
                    <span class="block text-xs text-gray-400">Total</span>
                    <span class="font-bold text-gray-900 text-lg" id="total-price">$0.00</span>
                </div>
                <button
                    class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold shadow-sm hover:bg-blue-700 transition-colors">
                    Save Box
                </button>
            </div>
        </div>

    </div>

    <script>
        const products = [
            { id: 1, name: "Organic Carrots", cat: "Vegetables", price: 2.99, img: "https://placehold.co/100x100?text=C" },
            { id: 2, name: "Red Potatoes", cat: "Vegetables", price: 3.49, img: "https://placehold.co/100x100?text=P" },
            { id: 3, name: "Kale Bunch", cat: "Vegetables", price: 1.99, img: "https://placehold.co/100x100?text=K" },
            { id: 4, name: "Honeycrisp Apple", cat: "Fruits", price: 0.89, img: "https://placehold.co/100x100?text=A" },
            { id: 5, name: "Bananas", cat: "Fruits", price: 0.69, img: "https://placehold.co/100x100?text=B" },
            { id: 6, name: "Sourdough Bread", cat: "Pantry", price: 5.99, img: "https://placehold.co/100x100?text=SB" },
            { id: 7, name: "Free Range Eggs", cat: "Pantry", price: 4.99, img: "https://placehold.co/100x100?text=E" },
            { id: 10, name: "Raw Honey", cat: "Pantry", price: 12.99, img: "https://placehold.co/100x100?text=H" },
        ];

        let box = [];
        let selectedIndex = 0;
        let filteredProducts = [];

        const input = document.getElementById('command-input');
        const suggestionBox = document.getElementById('suggestions');

        input.addEventListener('keyup', (e) => {
            const val = input.value.trim().toLowerCase();

            if (e.key === 'ArrowDown') {
                selectedIndex = Math.min(selectedIndex + 1, filteredProducts.length - 1);
                renderSuggestions();
                return;
            }
            if (e.key === 'ArrowUp') {
                selectedIndex = Math.max(selectedIndex - 1, 0);
                renderSuggestions();
                return;
            }
            if (e.key === 'Enter') {
                if (filteredProducts[selectedIndex]) {
                    addItem(filteredProducts[selectedIndex]);
                    input.value = '';
                    suggestionBox.classList.add('hidden');
                }
                return;
            }

            if (val.length === 0) {
                suggestionBox.classList.add('hidden');
                return;
            }

            filteredProducts = products.filter(p => p.name.toLowerCase().includes(val));
            selectedIndex = 0;

            if (filteredProducts.length > 0) {
                suggestionBox.classList.remove('hidden');
                renderSuggestions();
            } else {
                suggestionBox.classList.add('hidden');
            }
        });

        function renderSuggestions() {
            suggestionBox.innerHTML = filteredProducts.map((p, i) => `
                <div onclick="selectItem(${p.id})" class="p-3 flex items-center justify-between cursor-pointer hover:bg-gray-100 ${i === selectedIndex ? 'bg-blue-50 border-l-4 border-blue-500 pl-2' : ''}">
                    <div class="flex items-center gap-3">
                        <img src="${p.img}" class="w-8 h-8 rounded bg-gray-200">
                        <div>
                            <div class="font-bold text-gray-800 text-sm">${p.name}</div>
                            <div class="text-xs text-gray-500">${p.cat}</div>
                        </div>
                    </div>
                    <div class="text-sm font-mono text-gray-600">$${p.price.toFixed(2)}</div>
                </div>
            `).join('');
        }

        // Expose to onclick
        window.selectItem = (id) => {
            const p = products.find(x => x.id === id);
            if (p) {
                addItem(p);
                input.value = '';
                suggestionBox.classList.add('hidden');
                input.focus();
            }
        }

        function addItem(product) {
            const existing = box.find(i => i.id === product.id);
            if (existing) {
                existing.qty++;
            } else {
                box.push({ ...product, qty: 1 });
            }
            renderBox();

            // Log to status bar
            const status = document.getElementById('status-bar');
            status.textContent = `Added ${product.name}`;
            status.classList.add('text-green-600');
            setTimeout(() => {
                status.classList.remove('text-green-600');
                status.textContent = 'Ready';
            }, 2000);
        }

        function removeItem(id) {
            box = box.filter(i => i.id !== id);
            renderBox();
        }

        function renderBox() {
            const list = document.getElementById('box-items');
            const empty = document.getElementById('empty-msg');

            if (box.length === 0) {
                list.innerHTML = '';
                empty.style.display = 'block';
                document.getElementById('total-price').innerText = '$0.00';
                return;
            }

            empty.style.display = 'none';

            list.innerHTML = box.map(item => `
                <tr class="group hover:bg-gray-50">
                    <td class="px-6 py-3 font-medium text-gray-900">${item.name}</td>
                    <td class="px-6 py-3 text-center">
                        <input type="number" value="${item.qty}" class="w-16 p-1 border border-gray-300 rounded text-center text-xs">
                    </td>
                    <td class="px-6 py-3 text-right font-mono text-gray-600">$${(item.price * item.qty).toFixed(2)}</td>
                    <td class="px-6 py-3 text-right">
                        <button onclick="removeItem(${item.id})" class="text-gray-400 hover:text-red-500 transition-colors">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    </td>
                </tr>
            `).join('');

            const total = box.reduce((sum, i) => sum + (i.price * i.qty), 0);
            document.getElementById('total-price').innerText = '$' + total.toFixed(2);
        }

        // Focus input on load
        input.focus();
    </script>
</body>

</html>